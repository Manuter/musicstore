<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Products - The Manu Music Store</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
  <style>
    body {
      font-family: 'Arial', sans-serif;
      background: linear-gradient(135deg, #f5f7fa, #c3cfe2);
      margin: 0;
      padding: 20px;
    }

    .product-list, .cart {
      margin: 20px auto;
      max-width: 800px;
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      padding: 20px;
    }

    .product-item, .cart-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid #ddd;
      padding: 10px 0;
    }

    .cart-item:last-child, .product-item:last-child {
      border-bottom: none;
    }

    .btn-primary {
      background-color: #ff5f6d;
      border: none;
    }

    .btn-primary:hover {
      background-color: #ff3b4f;
    }

    #total {
      font-size: 1.5rem;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h1 class="text-center">Products</h1>

  <!-- Products Section -->
  <div class="product-list" id="productList">
    <h2>Available Products</h2>
    <p>Loading products...</p>
  </div>

  <!-- Cart Section -->
  <div class="cart" id="cart">
    <h2>Shopping Cart</h2>
    <div id="cartItems"></div>
    <p id="total">Total: €0.00</p>
    <button class="btn btn-primary w-100" id="checkout">Checkout</button>
  </div>

  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';

    const supabaseUrl = 'https://lbnatkrmeoxldqzudmfb.supabase.co'; // Replace with your Supabase URL
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxibmF0a3JtZW94bGRxenVkbWZiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzUyMjEzNTUsImV4cCI6MjA1MDc5NzM1NX0.rSNuOimmTv_BnrROF3xp-3xAM7Lr8EDAidgrw1Hkx4s'; // Replace with your anon key
    const supabase = createClient(supabaseUrl, supabaseKey);

    const productListElement = document.getElementById('productList');
    const cartElement = document.getElementById('cartItems');
    const totalElement = document.getElementById('total');
    const checkoutButton = document.getElementById('checkout');
    let cart = [];

    // Fetch products from Supabase
    async function fetchProducts() {
      const { data: products, error } = await supabase.from('products').select('*');
      if (error) {
        console.error('Error fetching products:', error);
        productListElement.innerHTML = `<p>Error loading products. Please try again later.</p>`;
        return;
      }

      productListElement.innerHTML = ''; // Clear placeholder

      products.forEach(product => {
        const productItem = document.createElement('div');
        productItem.className = 'product-item';
        productItem.innerHTML = `
          <div>
            <h3>${product.name}</h3>
            <p>${product.description}</p>
            <p><strong>Price: €${product.price.toFixed(2)}</strong></p>
          </div>
          <button class="btn btn-primary add-to-cart" data-id="${product.id}" data-name="${product.name}" data-price="${product.price}">
            Add to Cart
          </button>
        `;
        productListElement.appendChild(productItem);

        productItem.querySelector('.add-to-cart').addEventListener('click', () => {
          addToCart(product);
        });
      });
    }

    // Add product to cart
    function addToCart(product) {
      const existingProduct = cart.find(item => item.id === product.id);
      if (existingProduct) {
        existingProduct.quantity += 1;
      } else {
        cart.push({ ...product, quantity: 1 });
      }
      renderCart();
    }

    // Render the cart
    function renderCart() {
      cartElement.innerHTML = '';
      let total = 0;

      cart.forEach(item => {
        total += item.price * item.quantity;

        const cartItem = document.createElement('div');
        cartItem.className = 'cart-item';
        cartItem.innerHTML = `
          <span>${item.name} (x${item.quantity})</span>
          <span>€${(item.price * item.quantity).toFixed(2)}</span>
          <button class="btn btn-sm btn-danger" data-id="${item.id}">Remove</button>
        `;
        cartElement.appendChild(cartItem);

        cartItem.querySelector('button').addEventListener('click', () => {
          removeFromCart(item.id);
        });
      });

      totalElement.textContent = `Total: €${total.toFixed(2)}`;
    }

    // Remove product from cart
    function removeFromCart(id) {
      cart = cart.filter(item => item.id !== id);
      renderCart();
    }

    // Checkout logic
    checkoutButton.addEventListener('click', () => {
      if (cart.length === 0) {
        alert('Your cart is empty!');
        return;
      }

      alert('Proceeding to payment...');
      // Here you can integrate a payment gateway like Stripe.
    });

    // Load products on page load
    fetchProducts();
  </script>
</body>
</html>
